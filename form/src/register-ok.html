<? 
require_once(__DIR__ . '/../inc/include.php');

checkIfLogged();

$signInSuccessUrl = 'start.html';
if(isset($_GET['next'])){
    $signInSuccessUrl = $_GET['next'];
}

$post = $_POST;
$name = trim($post["name"]);
$msisdn = trim($post["msisdn"]);
$idnumber = strtoupper(trim($post["idnumber"]));

$address = str_replace(', Polska', '', trim($post["address"]));

try{
    $user = $storage->getCurrentUser();
}catch(Exception $e){ // creation mode
    $user = new User();
}

$user->updateUserData($name, $msisdn, $address, $idnumber);
$storage->saveUser($user);

_sendSlackUpdate("Nowa rejestracja *{$name}*.");

redirect($signInSuccessUrl);

?>
