$(document).on("pageinit pageshow",function(){if($("#address").length){$("a#geo").on("touchstart click",getAddress);getAddress();$("#address").on("change",function(){$("#address").removeClass("error")});$("#plateid").on("change",function(){$("#plateid").removeClass("error")})}if($("#pic1").length){if(window.File&&window.FileReader&&window.FormData){$(document).on("change","#pic1",function(a){checkFile(a.target.files[0],this.id)});$(document).on("change","#pic2",function(a){checkFile(a.target.files[0],this.id)})}else{}}if($("#form-submit").length){$("#form-submit").click(function(){if(validateForm()){$("#form").submit()}})}});function validateForm(){var a=check($("#plateid"),6,false);a=check($("#address"),10,false)&&a;a=check($("#pic2"),0,true)&&a;a=check($("#pic1"),0,true)&&a;if(!a){$(window).scrollTop($(".error").offset().top-100)}return a}function check(b,a,c){if(b.val().trim().length<=a){if(c){b.parent().parent().addClass("error")}else{b.addClass("error")}return false}else{return true}}function getAddress(){$("a#geo").buttonMarkup({icon:"clock"});$("#address").val("Pobieram adres...");if("geolocation" in navigator){var a={enableHighAccuracy:true,maximumAge:30000,timeout:27000};navigator.geolocation.getCurrentPosition(function(b){var c=b.coords.latitude+","+b.coords.longitude;$.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+c+"&key=AIzaSyAsVCGVrc7Zph5Ka3Gh2SGUqDrwCd8C3DU&language=pl&result_type=street_address",function(d){$("#address").val(d.results[0].formatted_address.replace(", Polska",""));$("a#geo").buttonMarkup({icon:"refresh"});$("#latlng").val(c)})},function(b){$("a#geo").buttonMarkup({icon:"alert"});$("#address").val("")},a)}else{$("a#geo").buttonMarkup({icon:"alert"})}}function checkFile(a,b){$("#"+b).parent().parent().removeClass("error");$("img#img"+b).attr("src","img/loading.gif");if(b=="pic2"){$("#imgpic2Plate").attr("src","")}if(a){if(/^image\//i.test(a.type)){readFile(a,b)}else{$("img#img"+b).attr("src","img/camera.png");$("#"+b).textinput("enable")}}}function readFile(b,c){var a=new FileReader();a.onloadend=function(){processFile(a.result,b.type,c)};a.onerror=function(){$("img#img"+c).attr("src","img/camera.png");$("#"+c).textinput("enable")};a.readAsDataURL(b)}function processFile(e,a,f){var c=1200,b=1200,d=new Image();d.src=e;d.onload=function(){var k=d.width,g=d.height;var m=(k>c)||(g>b);if(!m){sendFile(e,f);return}var l,h;if(k>g){h=g*(c/k);l=c}else{l=k*(b/g);h=b}var i=document.createElement("canvas");i.width=l;i.height=h;var j=i.getContext("2d");j.drawImage(this,0,0,l,h);e=i.toDataURL(a);sendFile(e,f)};d.onerror=function(){$("img#img"+f).attr("src","img/camera.png");$("#"+f).textinput("enable")}}function sendFile(a,c){var b=new FormData();b.append("image_data",a);b.append("id",c);$.ajax({type:"POST",url:"/upload.html",data:b,contentType:false,processData:false,success:function(d){json=$.parseJSON(d);if(json.thumbUrl){$("img#img"+c).attr("src",json.thumbUrl);$("#"+c).textinput("disable");$("#"+c+"Url").val(json.imageUrl);$("#"+c+"Thumb").val(json.thumbUrl)}else{}if(c=="pic2"&&json.plate){$("#plateid").val(json.plate)}else{}if(c=="pic2"&&json.plateImage){$("#imgpic2Plate").attr("src",json.plateImage)}else{}},error:function(d){$("img#img"+c).attr("src","img/camera.png");$("#"+c).textinput("enable")}})};