$(document).on("pageinit pageshow",function(){if($("#address").length){$("#address").on("change",function(){$("#address").removeClass("error")});$("#plateid").on("change",function(){$("#plateid").removeClass("error")})}if($("#contextImage").length){if(window.File&&window.FileReader&&window.FormData){$(document).on("change","#contextImage",function(a){checkFile(a.target.files[0],this.id)});$(document).on("change","#carImage",function(a){checkFile(a.target.files[0],this.id)})}$("#plateImage").hide()}if($("#form-submit").length){$("#form-submit").click(function(){if(validateForm()){$("#form").submit()}})}});function validateForm(){var a=check($("#plateid"),6,false);a=check($("#address"),10,false)&&a;a=check($("#carImage"),0,true)&&a;a=check($("#contextImage"),0,true)&&a;a=check($("#name"),5,false)&&a;a=check($("#email"),5,false)&&a;if(!a){$(window).scrollTop($(".error").offset().top-100)}return a}function check(b,a,c){if(b.val().trim().length<=a){if(c){b.parent().parent().addClass("error")}else{b.addClass("error")}return false}else{return true}}function setAddress(a){$("a#geo").buttonMarkup({icon:"clock"});$("#address").val("");$("#address").attr("placeholder","(pobieram adres ze zdjÄ™cia...)");$.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+"&key=AIzaSyAsVCGVrc7Zph5Ka3Gh2SGUqDrwCd8C3DU&language=pl&result_type=street_address",function(b){if(b.results){$("#address").val(b.results[0].formatted_address.replace(", Polska",""));$("a#geo").buttonMarkup({icon:"check"});$("#latlng").val(a)}else{$("a#geo").buttonMarkup({icon:"alert"});$("#latlng").val("")}}).fail(function(){$("a#geo").buttonMarkup({icon:"alert"});$("#latlng").val("")})}function checkFile(a,b){$("#"+b).parent().parent().removeClass("error");$("img#"+b+"-img").attr("src","img/loading.gif");if(b=="carImage"){$("#plateImage").attr("src","");$("#plateImage").hide()}if(a){if(/^image\//i.test(a.type)){readFile(a,b)}else{$("#"+b).textinput("enable");$("img#"+b+"-img").attr("src","img/camera.png")}}}function readFile(b,c){var a=new FileReader();a.onloadend=function(){processFile(a.result,b.type,c)};a.onerror=function(){$("#"+c).textinput("enable");$("img#"+c+"-img").attr("src","img/camera.png")};a.readAsDataURL(b)}function processFile(e,a,f){var c=1200,b=1200,d=new Image();d.src=e;d.onload=function(){var k=d.width,g=d.height;var m=(k>c)||(g>b);if(!m){sendFile(e,f);return}var l,h;if(k>g){h=g*(c/k);l=c}else{l=k*(b/g);h=b}var i=document.createElement("canvas");i.width=l;i.height=h;var j=i.getContext("2d");j.drawImage(this,0,0,l,h);e=i.toDataURL(a);sendFile(e,f)};d.onerror=function(){$("img#"+f+"-img").attr("src","img/camera.png");$("#"+f).textinput("enable")}}function sendFile(a,c){var b=new FormData();b.append("image_data",a);b.append("id",c);$.ajax({type:"POST",url:"/upload.html",data:b,contentType:false,processData:false,success:function(d){json=$.parseJSON(d);if(json.carImage){$("img#"+c+"-img").attr("src",json.carImage.thumb);$("#"+c).textinput("disable")}if(json.contextImage){$("img#"+c+"-img").attr("src",json.contextImage.thumb);$("#"+c).textinput("disable")}if(json.address){setAddress(json.address.lat+","+json.address.lng)}if(c=="carImage"&&json.carInfo.plateId){$("#plateid").val(json.carInfo.plateId)}if(c=="carImage"&&json.carInfo.plateImage){$("#plateImage").attr("src",json.carInfo.plateImage);$("#plateImage").show()}},error:function(d){$("img#"+c+"-img").attr("src","img/camera.png");$("#"+c).textinput("enable")}})};