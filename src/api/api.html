<?PHP
header("Content-Type: application/json; charset=UTF-8");

require(__DIR__ . '/../../inc/API.php');

if(isset($_GET["action"]) && $_GET["action"] == "initLogs"){
    _initLogs();
    die();
}

if (is_ajax()) {
    if (isset($_POST["action"]) && !empty($_POST["action"])) {
        $action = $_POST["action"];
        switch($action) {
            case "verifyToken": _verifyToken(); break;
            case "archived":
            case "confirmed":
            case "confirmed-waiting":
            case "confirmed-waitingE":
            case "confirmed-sm":
            case "confirmed-ignored":
            case "confirmed-fined":
            case "confirmed-instructed":
                _setStatus($action, $_POST["id"]); break;
            case "send":
                _send($_POST["id"]); break;
            case "upload":
                $imageBytes = explode( ',', $_POST['image_data'])[1]; 
                $pictureType = $_POST['pictureType'];
                $appId = $_POST['applicationId'];
                _upload($appId, $pictureType, $imageBytes);
                break;
            case "getApp":
                _getAppDetails($_POST["id"]); break;
            case "geoToAddress":
                _geoToAddress($_POST["lat"], $_POST["lng"]); break;
            case "addToGallery":
                _addToGallery($_POST["id"]); break;
            case "moderateApp":
                _moderateApp($_POST["id"], $_POST["decision"]); break;
            case "getAppByNumber":
                _getAppByNumber($_POST["number"], $_POST["apiToken"]); break;
            case "getUserByName":
                _getUserByName($_POST["name"], $_POST["apiToken"]); break;
            default: raiseError('Invalid action specified', 400);
        }
    }else{
        raiseError('No action specified', 400);
    }
}else{
    raiseError('No AJAX request', 403);
}

?>
