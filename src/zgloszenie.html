<? 
require_once(__DIR__ . '/../inc/include.php');

$applicationId = $_GET["id"];
$application = $storage->getApplication($applicationId);

$isAppOwnerOrAdmin = false;
$isAppOwner = false;
if(isLoggedIn()){
    $isAppOwner = getCurrentUserEmail() == $application->user->email;
    $isAppOwnerOrAdmin = ($storage->getCurrentUser()->isAdmin()) || ($isAppOwner);
}

echo generate('zgloszenie.html.twig', 
    [
        'head' =>
        [
            'title' => "Zgłoszenie {$application->number} z dnia {$application->getDate()}",
            'shortTitle' => "Zgłoszenie {$application->number}",
            'image' => $application->contextImage->thumb,
            'dialog' => isset($_GET['dialog']),
            'description' => "Samochód o nr rejestracyjnym {$application->carInfo->plateId} " .
                "w okolicy adresu {$application->address->address}. {$application->getCategory()->getShort()}"
        ],
        'config' =>
        [
            'isAppOwnerOrAdmin' => $isAppOwnerOrAdmin,
            'isAppOwner' => $isAppOwner
        ],
        'app' => $application
    ]
);
?>
