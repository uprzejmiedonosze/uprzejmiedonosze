<? 
require_once(__DIR__ . '/../inc/include.php');

checkIfLogged();

$signInSuccessUrl = 'start.html';
if(isset($_GET['next'])){
    $signInSuccessUrl = $_GET['next'];
}

$post = $_POST;
$name = capitalizeName($post["name"]);
$msisdn = trim($post["msisdn"]);
$exposeData = isset($post['exposeData']) && $post['exposeData'] == 'Y';
$stopAgresji = isset($post['stopAgresji']) && $post['stopAgresji'] == 'SA';

$address = str_replace(', Polska', '', trim($post["address"]));

try{
    $user = $storage->getCurrentUser();
}catch(Exception $e){ // creation mode
    $user = new User();
}

$user->updateUserData($name, $msisdn, $address, $exposeData, $stopAgresji);
$storage->saveUser($user);

if(null == $_GET('update')) _sendSlackOnRegister($user);

redirect($signInSuccessUrl);

?>
