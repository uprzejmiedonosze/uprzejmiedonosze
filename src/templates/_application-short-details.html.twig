{% set recydywa = app.getRecydywa %}
{% set recydywaCnt = recydywa.appsCnt %}
{% set status = app.getStatus %}
{% set sendable = status.sendable %}

<div class="images-slider">
    <div class="imageContainer">
        <a target="_blank" href="/ud-{{ app.id }}.html">
            <img src="{{ app.contextImage.thumb }}?v={{ app.getRevision }}">
        </a>
    </div>
    <div class="imageContainer">
        <a target="_blank" href="/ud-{{ app.id }}.html">
            <img src="{{ app.carImage.thumb }}?v={{ app.getRevision }}">
        </a>
    </div>
</div>
<div class="application-details-list">
    <div class="current-status">
        <b>{{ status.name|upper }}
        {%if app.guessSMData.isPolice %}<span title="Zg≈Çoszenie na Policjƒô">üëÆ‚Äç‚ôÄÔ∏è</span>{% endif %}</b>

        {% if appActionButtons %}
            <a href="#changeStatus{{ app.id }}" data-rel="popup" data-transition="none" aria-haspopup="true"
                aria-owns="changeStatus{{ app.id }}" aria-expanded="false"
                data-inline="true" data-mini="true"
                class="button small light change-status">ZMIE≈É
            </a>
            <div style="display: none;"><!-- placeholder for pre-rendered --></div>
        {% endif %}

        Zg≈Çoszenie&nbsp;<tt>{{ app.number }}</tt>
    </div>

        
    <div class="calendar"><b>{{ app.getDate("d.MM.YYYY, H:mm (eee)")|raw }}</b></div>

    <div class="address">{{ app.address.address }}</div>
    {% if sendable %}
        <div class="no-icon">
            {% if app.automatedSM %}
                <a href="#" onclick="sendApplication('{{ app.id }}');" data-inline="true" data-mini="true"
                class="button inline cta confirmed-waiting">
                    Wy≈õlij do {{ app.guessSMData.getShortName }}
                </a>
            {% elseif app.unknownSM %}
                <a href="/brak-sm.html?id={{ app.id }}" data-ajax="false"
                class="button inline cta confirmed-waiting">
                    Wy≈õlij zg≈Çoszenie
                </a>
            {% elseif wysylka is not defined %}
                <a href="/wysylka.html?city={{ app.guessSMData.key|url_encode }}" data-ajax="false"
                class="button inline cta confirmed-waiting">
                    Wy≈õlij zg≈Çoszenie
                </a>
            {% endif %}
            {% if appActionButtons and app.isEditable %}
                <br>
                <a href="/nowe-zgloszenie.html?edit={{ app.id }}" class="button inline light" data-ajax="false">edytuj</a>
            {% endif %}
        </div>
    {% endif %}


    {% if recydywaCnt > 1 %}
    <div class="recydywa"><b>RECYDYWA</b><br>
        <p data-recydywacnt="{{ recydywaCnt }}" class="recydywa-appscnt"> {{ num(recydywaCnt, ['wykrocze≈Ñ', 'wykroczenie', 'wykroczenia']) }}
            {% if recydywa.usersCnt > 1 %}<span class="recydywa-userscnt"> {{ recydywa.usersCnt }} zg≈ÇaszajƒÖcych</span>{% endif %}
            <a href="#" data-rel="popup" data-inline="true" data-mini="true"
                data-plateid="{{ app.carInfo.plateId }}"
                class="button small recydywa-seemore">
                Zobacz zg≈Çoszenia
            </a>
        </p>
    </div>
    {% endif %}

    <div class="description"><b>TRE≈öƒÜ ZG≈ÅOSZENIA</b>
        <p>
            {{ app.getCategory.formal }} {{ app.getExtensionsText }} {% if app.userComment %}{{ app.getAHrefedComment | raw }}{% endif %}
        </p>
    </div>
    <div class="info-icon"><b>INFORMACJE DODATKOWE</b>
        <p>
            {% if app.statements is not defined or not app.statements.witness %}
            <b>Nie {{ app.guessUserSex.bylas }}</b> ≈õwiadkiem parkowania.
            {% else %}
            <b>{{ app.guessUserSex.bylas|capitalize }} ≈õwiadkiem</b> parkowania.
            {% endif %}
            {% if app.wasSent %}
        </p>
        <p>
            Wys≈Çano do {%if app.guessSMData.isPolice %}üëÆ‚Äç‚ôÄÔ∏è {% endif %}<b>{{ app.guessSMData.getShortName }}</b>
                {{ app.getSentDate("d MMMM YYYY 'o' H:mm")|raw }}
            {% endif %}
        </p>
    </div>
</div>

<div class="application-details-list">
    {% if app.wasSent %}
        <div class="external-id no-icon">NUMER SPRAWY SM/Policji
            <p>
                <input class="app-field-editable" name="externalId" data-initial-value="{{ app.externalId }}" type="text" placeholder="RSOW 0000/24 / WP 000/24" value="{{ app.externalId }}">
            </p>
        </div>
    {% endif %}
    <div class="private-comment no-icon">UWAGI (widoczne tylko dla Ciebie)
        <p>
            <textarea class="app-field-editable" name="privateComment" data-initial-value="{{ app.privateComment }}" placeholder="">{{ app.privateComment }}</textarea>
        </p>
    </div>
</div>

<div id="changeStatus{{ app.id }}-screen" class="ui-popup-screen ui-overlay-inherit ui-screen-hidden"></div>
<div id="changeStatus{{ app.id }}-popup" class="ui-popup-container ui-popup-hidden ui-popup-truncate">
    <div data-role="popup" id="changeStatus{{ app.id }}" data-enhanced="true" data-transition="none" class="application-short ui-popup ui-body-inherit ui-overlay-shadow">
        <ul data-role="listview" data-inset="true" class="ui-listview ui-listview-inset change-status">
            <li data-role="list-divider" role="heading" class="ui-li-divider ui-bar-inherit ui-first-child">
                Zmie≈Ñ status zg≈Çoszenia z <span class="currentStatus">{{ status.name }}</span> na:
            </li>
            {% for key,val in statuses %}
            {% if val.class == 'bottom' %}
            {% set liStyle = '' %}
            {% if key not in status.allowed %}
            {% set liStyle = 'style="display: none;"' %}
            {% endif %}
            <li {{ liStyle|raw }}>
                <a href="#" onclick="setStatus('{{ app.id }}', '{{ key }}')" data-inline="true" data-mini="true" class="ui-btn ui-btn-icon-left ui-nodisc-icon ui-mini 
                            {{ val.cta ?? '' }}
                            {{ key }}">{{ val.action }}</a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>
