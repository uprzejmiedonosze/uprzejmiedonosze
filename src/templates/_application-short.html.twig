{% set recydywaCnt = app.getRecydywa %}
{% set recydywa = '' %}
{% if recydywaCnt > 1 %}
{% set wrappedPlateId = "'" ~ app.carInfo.plateId ~ "'" %}
{% set recydywa = ' üö® <a href="#" onclick="window._recydywa(' ~ wrappedPlateId  ~ ')"><sup>recydywa#' ~ recydywaCnt ~ '</sup></a>' %}
{% endif %}

{% set status = app.getStatus %}
{% set sendable = status.sendable %}

{% macro icon(name) %}
<span class="ui-btn ui-corner-all ui-icon-{{name}} ui-btn-icon-notext ui-btn-inline ui-btn-fake"></span>
{% endmacro %}

<div id="{{ app.id }}"
    {% if hideAppOverLimit is defined %}style="display: none;"{% endif %}
    class="application application-short status-all {{ app.status }}"
    data-collapsed-icon="{{ status.icon }}"
    data-expanded-icon="{{ status.icon }}"
    data-role="collapsible"
    data-filtertext="{{ app.address.address }} {{app.number}} {{app.date}} {{app.carInfo.plateId}} {{app.userComment}} {{app.getCategory.short}} {{ app.guessSMData.getName }} {% if recydywaCnt > 1 %}recydywa{{ recydywaCnt }}{% endif %}">

    <h3>
        <span title="{{ app.number }}" class="app-number">{{ app.seq }}</span>
        <img title="{{app.getCategory.short}}" src="/img/{{ app.category }}.jpg">
        {{ app.getDate }},
        {{ app.getShortAddress }}
        {%if app.guessSMData.isPolice %}<span title="Zg≈Çoszenie na Policjƒô">üëÆ‚Äç‚ôÄÔ∏è{% endif %}</span>
        {% if recydywaCnt > 1 %}<span title="Recydywa#{{ recydywaCnt }}">üö®</span>{% endif %}
    </h3>

    <div data-role="listview" data-inset="false">
        <ul class="application-details-list">
            <li class="calendar"><b>{{ app.getHRDate }}, {{ app.getTime }}</b></li>
            <li class="plate-id"><span class="plate-id">{{ app.carInfo.plateId }}</span>{{ recydywa|raw }}</li>
            <li class="address"><a href="{{ app.getMapUrl }}" data-ajax="false" target="_blank">{{ app.address.address }}</a></li>
            <li class="status {{app.status}}"><b class="currentStatus">{{ status.name }}</b>
                {% if appActionButtons %}
                <a href="#changeStatus{{ app.id }}" data-rel="popup" data-transition="none">
                    (zmie≈Ñ status)
                </a>
                <div data-role="popup" id="changeStatus{{ app.id }}" class="application-short">
                    <ul data-role="listview" data-inset="true" style="min-width:210px;">
                        <li data-role="list-divider">
                            Zmie≈Ñ rƒôcznie status zg≈Çoszenia z <span class="currentStatus">{{ status.name }}</span> na:
                        </li>
                        {% for key,val in statuses %}
                        {% if val.class == 'bottom' %}
                        <li style="{% if key not in status.allowed %}display: none;{% endif %}">
                            <a href="#" onclick="setStatus('{{ app.id }}', '{{ key }}')" data-inline="true" data-mini="true"
                            class="ui-btn ui-btn-inline ui-btn-icon-left ui-corner-all ui-nodisc-icon ui-mini
                                {{ val.cta ?? '' }}
                                ui-icon-{{ val.icon }}
                                {{ key }}">{{ val.action }}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </li>
            <li class="sent-to">Wys≈Çano do {%if app.guessSMData.isPolice %}üëÆ‚Äç‚ôÄÔ∏è {% endif %}<b>{{ app.guessSMData.getShortName }}</b></li>
            <li class="description"><b>{{ app.getCategory.short }}</b> {{ app.getExtensionsText }} {% if app.userComment %}{{ app.getAHrefedComment | raw }}{% endif %}</li>
            <li class="witness">
                {% if app.statements is not defined or not app.statements.witness %}
                    <b>Nie {{ app.guessUserSex.bylas }}</b> ≈õwiadkiem parkowania.
                {% else %}
                    <b>{{ app.guessUserSex.bylas|capitalize }} ≈õwiadkiem</b> parkowania.</p>
                {% endif %}
            </li>
        </ul>

        {% if status.topButtons %}
        <div>
            {% if app.automatedSM and autoSend is defined and autoSend %}
            <a href="#" onclick="sendApplication('{{ app.id }}');"
                data-inline="true" data-mini="true"
                class="ui-btn ui-btn-inline ui-btn-icon-left ui-corner-all ui-nodisc-icon ui-mini
            {% if sendable %}cta{% else %}hidden{% endif %}
            ui-icon-{{ statuses['confirmed-waiting'].icon }}
            confirmed-waiting">Wy≈õlij {% if sendable %}do {{ app.guessSMData.getShortName }}{% else %}zg≈Çoszenie{% endif %}</a>
            {% elseif app.unknownSM %}
            <a href="/brak-sm.html?id={{ app.id }}"
                class="ui-btn ui-btn-inline ui-btn-icon-left ui-corner-all ui-nodisc-icon ui-mini ui-icon-mail
            {% if sendable %}cta{% else %}hidden{% endif %}
            confirmed-waiting">Wy≈õlij zg≈Çoszenie</a>
            {% elseif wysylka is not defined %}
            <a href="/wysylka.html?city={{ app.guessSMData.key|url_encode }}" data-ajax="false"
            class="ui-btn ui-btn-inline ui-btn-icon-left ui-corner-all ui-nodisc-icon ui-mini ui-icon-mail confirmed-waiting
            {% if sendable %}cta{% else %}hidden{% endif %}">Wy≈õlij zg≈Çoszenie</a>
            {% endif %}
            {% if appActionButtons %}
            <a href="/nowe-zgloszenie.html?edit={{ app.id }}" data-ajax="false"
            class="ui-btn ui-btn-inline ui-btn-icon-left ui-corner-all ui-nodisc-icon ui-mini
            {% if not app.isEditable %}hidden{% endif %}
            ui-icon-edit ui-alt-icon">Edytuj</a>
            {% endif %}
        </div>

        {% endif %}
        <div class="ui-grid-a ui-responsive images images-cropped">
            <div class="ui-block-a imageContainer">
                <div class="loader"></div>
                <a href="/ud-{{ app.id }}.html?dialog">
                    <img class="lazyload" data-src="{{ app.contextImage.thumb }}?v={{ app.getRevision }}">
                </a>
            </div>
            <div class="ui-block-b imageContainer">
                <div class="loader"></div>
                <a href="/ud-{{ app.id }}.html?dialog">
                    <img class="lazyload" data-src="{{ app.carImage.thumb }}?v={{ app.getRevision }}">
                </a>
            </div>
        </div>
    </div> <!-- data-role="listview" data-inset="false" -->
</div>