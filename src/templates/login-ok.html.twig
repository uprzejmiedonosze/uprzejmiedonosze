{% extends "base.html.twig" %}

{% block main %}

{% include('_firebase.html.twig') %}

<script type="text/javascript">
    function initApp() {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                user.getIdToken().then(function(accessToken) {
                    $.post('api/api.html', {
                            action: 'verifyToken',
                            pa: accessToken
                        },
                        function(data) {
                            window.location.replace('{{ config.signInSuccessUrl ?? 'moje-zgloszenia.html' }}');
                        }).fail(function(error){
                            window.location.replace('/login.html?error=' + error);
                        });
                    });
            } else {
                window.location.replace('/login.html');
            }
        }, function(error) {
            console.log(error);
            window.location.replace('/login.html?error=' + error);
        });
    };

    window.addEventListener('load', initApp);
</script>
{% endblock %}

{% block header %}
{% endblock %}

{% block jsIncludes %}
{% endblock %}

{% block footer %}
<div data-role="footer">
    <h4>trwa logowanie</h4>
</div> <!-- footer -->
{% endblock %}