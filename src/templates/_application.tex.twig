{% block commands %}
    \renewcommand{\n}{ {{ app.user.name }} }
    \rhead{ Dnia {{ app.getDate }} }
{% endblock %}

\vspace{\stretch{3}}\noindent
{\large {{ app.guessSMData().getLatexAddress() }} }

{% set appUrl = '{%HTTPS%://%HOST%/ud-' ~ app.id  ~ '.html?s=pdf}' %}
{% set qrUrl = '{%HTTPS%://%HOST%/ud-' ~ app.id  ~ '.html?s=qr}' %}
{% set mapUrl = '{' ~ app.getMapUrl() ~ '}' %}

{% set contextImageUrl = '{%HTTPS%://%HOST%/' ~ app.contextImage.url ~ '?download}' %}
{% set carImageUrl     = '{%HTTPS%://%HOST%/' ~ app.carImage.url ~ '?download}' %}

{% set contextImage = '{' ~ root ~ '/' ~ app.contextImage.thumb ~ '}' %}
{% set carImage     = '{' ~ root ~ '/' ~ app.carImage.thumb ~ '}' %}
{% set mapImage     = '{' ~ root ~ '/' ~ app.getMapImage ~ '}' %}

{% set appNumber    = '\\underline{\\texttt{' ~ app.number ~ '}}' %}

\vspace{15 mm}
\begin{center}
    {\Large
        \href{{ appUrl }}{Zgłoszenie wykroczenia {{ appNumber|raw }} }
        {% if app.sentViaAPI is defined %}\footnote{\noindent Pamiętaj, że to zgłoszenie zostało wysłane do {{ app.guessSMData.city }} poprzez API. Odpowiedź to {{ app.sentViaAPI }} }.{% endif %}
    }
\end{center}

    W dniu {{ app.getDate }} {{ app.getDateTimeDivider }} {{ app.getTime }} {{ app.guessUserSex.bylam }}
    świadkiem wykroczenia kierowcy pojazdu o nr. rejestracyjnym\texttt{ {{ app.carInfo.plateId }} }w~okolicy adresu
    {{ app.getLatexSafeAddress|raw }}{% if app.sentViaAPI is not defined %}\footnote{\noindent Kod QR oraz numer {{ app.number }} prowadzą do wersji online tego zgłoszenia.
    {# jeśli zgłoszenie zostało wysłane przez API, to pokazuję odpowiedni komunikat (widać go powyżej) #}
    {# ale równocześnie chowam hint dotyczący mapy - bo zgłoszenia robią się dwustronicowe #}
    Obrazek z mapą prowadzi do Google Maps z lokalizacją zgłoszenia. Natomiast zdjęcia można ,,kliknąć'' aby uzyskać ich powiększenie.}{% endif %}.
    {{ app.getCategory.formal }} 
    {{ app.getExtensionsText() }}
    Sytuacja jest widoczna na załączonych zdjęciach.
    Zdjęcia {{ app.guessUserSex.wykonalam }} samodzielnie. {{ app.getLatexSafeComment|raw }}
{% if app.statements is not defined or not app.statements.witness %}
    Nie {{ app.guessUserSex.bylam }} świadkiem samego momentu parkowania.
{% endif %}

{% if not (app.user.exposeData ?? false) %}
    Równocześnie proszę o \textbf{niezamieszczanie} w protokole danych dotyczących mojego miejsca
    zamieszkania, nr. telefonu i~adresu e-mail.
{% endif %}

\vspace{0.3cm}\noindent
Z poważaniem

\vspace{0.3cm}
{\it Dane {{ app.guessUserSex.zglaszajacej }} w wiadomości e-mail 
    {% if app.sent is defined %}
        wysłanej {{ app.sent.date|date('j.m.Y H:i') }}
        na adres {{ app.sent.to }}
    {% endif %}
}

{\it Proszę o kontakt za pośrednictwem poczty e-mail oraz niewysyłanie korespondencji Pocztą Polską.}

\vspace{\stretch{3}}\noindent
    \href{{ contextImageUrl }}
        {\includegraphics[width=0.5\textwidth,height=0.5\textwidth,clip=true,keepaspectratio=true]{{ contextImage }} }
    \href{{ carImageUrl }}
        {\includegraphics[width=0.5\textwidth,height=0.5\textwidth,clip=true,keepaspectratio=true]{{ carImage }} }

\vspace{0.3cm}\noindent
    {% if app.isMapImageInCDN %}
    \href{{ mapUrl|raw }}
        {\includegraphics[width=0.5\textwidth,height=0.3\textwidth,clip=true,keepaspectratio=true]{{ mapImage }} }
    {% endif %}
    {% if app.shouldIncludePlateImage %}
    {% set plateImage   = '{' ~ root ~ '/' ~ app.carInfo.plateImage ~ '}' %}
    \includegraphics[valign=B,width=0.2\textwidth,height=0.2\textwidth,clip=true,keepaspectratio=true]{{ plateImage }}
    {% endif %}
    \hspace{\stretch{1}}
    \adjustbox{valign=B}{\qrcode[nolink,height=0.2\textwidth,level=Q]{{qrUrl|raw}}}
\vspace{\stretch{1}}