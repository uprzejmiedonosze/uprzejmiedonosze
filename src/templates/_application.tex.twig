{% block commands %}
    \renewcommand{\n}{ {{ app.user.name }} }
    \rhead{ Dnia {{ app.getDate }} }
{% endblock %}

\vspace{\stretch{3}}\noindent
{\large {{ app.guessSMData().getLatexAddress() }} }

{% set addressUrl = '{%HTTPS%://%HOST%/ud-' ~ app.id  ~ '.html?s=pdf}' %}
{% set qrUrl = '{%HTTPS%://%HOST%/ud-' ~ app.id  ~ '.html?s=qr}' %}
{% set mapUrl = '{https://www.google.com/maps/search/?api=1&query=' ~ app.getLatLng() ~ '}' %}

{% set contextImageUrl = '{%HTTPS%://%HOST%/' ~ app.contextImage.url ~ '?download}' %}
{% set carImageUrl     = '{%HTTPS%://%HOST%/' ~ app.carImage.url ~ '?download}' %}

{% set contextImage = '{' ~ root ~ '/' ~ app.contextImage.thumb ~ '}' %}
{% set carImage     = '{' ~ root ~ '/' ~ app.carImage.thumb ~ '}' %}
{% set mapImage     = '{' ~ root ~ '/' ~ app.getMapImage ~ '}' %}
{% set address      = '{\\underline{' ~ ( app.getLatexSafeAddress|raw ) ~ '}}' %}

\vspace{\stretch{2}}
\begin{center}
{\Large Zgłoszenie wykroczenia\texttt{ {{ app.number }} }{% if app.sentViaAPI is defined %}\footnote{\noindent Pamiętaj,
że to zgłoszenie zostało wysłane do {{ app.guessSMData.city }} poprzez API. Odpowiedź to {{ app.sentViaAPI }}.{% endif %}} }
\end{center}

    W dniu {{ app.getDate }} {{ app.getDateTimeDivider }} {{ app.getTime }} {{ app.guessUserSex.bylam }}
    świadkiem pozostawienia pojazdu o nr. rejestracyjnym\texttt{ {{ app.carInfo.plateId }} }w~okolicy adresu
    \href{{ addressUrl }}{{ address|raw }}{% if app.sentViaAPI is not defined %}\footnote{\noindent Adres oraz mapa, są równocześnie linkami prowadzącymi
    {# jeśli zgłoszenie zostało wysłane przez API, to pokazuję odpowiedni komunikat (widać go powyżej) #}
    {# ale równocześnie chowam hint dotyczący mapy - bo zgłoszenia robią się dwustronnicowe #}
    do mapy z lokalizacją zgłoszenia. Podobnie zdjęcia można ,,kliknąć'' aby uzyskać ich powiększenie.
    Kod QR prowadzi do wersji online tego zgłoszenia.}{% endif %}.
    {{ app.getCategory.short }} 
    {{ app.getExtensionsText() }}
    Sytuacja jest widoczna na załączonych zdjęciach.
    Zdjęcia {{ app.guessUserSex.wykonalam }} samodzielnie. {{ app.getLatexSafeComment|raw }}
{% if app.statements is not defined or not app.statements.witness %}
    Nie {{ app.guessUserSex.bylam }} świadkiem samego momentu parkowania.
{% endif %}

{% if app.user.exposeData is not defined or not app.user.exposeData %}
    Równocześnie proszę o \textbf{niezamieszczanie} w protokole danych dotyczących mojego miejsca
    zamieszkania, nr. telefonu i~adresu e-mail.
{% endif %}

\vspace{0.3cm}\noindent
Z poważaniem

\vspace{0.3cm}
{% if app.hideNameInPdf %}
{\it Dane {{ app.guessUserSex.zglaszajacej }} w wiadomości e-mail 
    {% if app.sent is defined %}
        wysłanej {{ app.sent.date|date('Y-m-d H:i') }}
        na adres {{ app.sent.to }}
    {% endif %}
}
{% else %}
{\it \n{}

{{ app.user.address }}

Email: {{ app.user.email }}

{% if app.user.msisdn %}Tel: {% endif %}{{ app.user.msisdn }} }
{% endif %}

{\it Proszę o kontakt za pośrednictwem poczty e-mail oraz niewysyłanie korespondencji Pocztą Polską.}

\vspace{\stretch{3}}\noindent
    \href{{ contextImageUrl }}
        {\includegraphics[width=0.5\textwidth,height=0.5\textwidth,clip=true,keepaspectratio=true]{{ contextImage }} }
    \href{{ carImageUrl }}
        {\includegraphics[width=0.5\textwidth,height=0.5\textwidth,clip=true,keepaspectratio=true]{{ carImage }} }

\vspace{0.3cm}\noindent
    \href{{ mapUrl|raw }}
        {\includegraphics[width=0.5\textwidth,height=0.3\textwidth,clip=true,keepaspectratio=true]{{ mapImage }} }
    {% if app.shouldIncludePlateImage %}
    {% set plateImage   = '{' ~ root ~ '/' ~ app.carInfo.plateImage ~ '}' %}
    \includegraphics[valign=B,width=0.2\textwidth,height=0.2\textwidth,clip=true,keepaspectratio=true]{{ plateImage }}
    {% endif %}
    \hspace{\stretch{1}}
    \adjustbox{valign=B}{\qrcode[height=0.2\textwidth,level=Q]{{qrUrl|raw}}}
\vspace{\stretch{1}}